<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="MySqlConnector.html">MySqlConnector</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MySqlConnector.html#connect">connect</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MySqlConnector.html#execute">execute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MySqlConnector.html#stop">stop</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="MySqlConnector.html#transaction">transaction</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#optionsSchema">optionsSchema</a></span></li>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h1>@goodware/mysql: A mysql2-based connection helper</h1>
<p>Better documentation is coming</p>
<h1>Links</h1>
<ul>
<li><a href="https://www.npmjs.com/package/@goodware/mysql">npm</a></li>
<li><a href="https://github.com/good-ware/js-mysql">git</a></li>
<li><a href="https://good-ware.github.io/js-mysql/">API</a></li>
</ul>
<h1>Requirements</h1>
<ul>
<li>ES5+ (lts/dubnium or later is recommended)</li>
</ul>
<h1>Features</h1>
<ul>
<li>Creates database connections via mysql2-promise, optionally from a pool, with exponential backoff retry</li>
<li>Handles AWS RDS passwordless IAM connections</li>
<li>Optionally manages database transactions by wrapping begin end transaction comments around a function invocation</li>
<li>Same API whether using connection pooling or individual connections</li>
<li>Same API whether using explicit or implicit transactions</li>
</ul>
<h1>Installation</h1>
<p><code>npm i --save @goodware/mysql</code></p>
<h2>Breaking change! Peer dependencies for versions 3+</h2>
<p>All runtime dependencies in version 3 were changed to use peer dependencies.</p>
<p>If you're missing a dependency, you have three options:</p>
<ol>
<li>Stick with version 2.x</li>
</ol>
<p><code>npm i --save @goodware/mysql@2</code></p>
<p>Or, in package.json dependencies:</p>
<p><code>&quot;@goodware/mysql&quot;: &quot;^2.0.0&quot;</code></p>
<ol start="2">
<li>Add the missing dependencies to your package.json</li>
<li>Upgrade to npm version 7</li>
</ol>
<p><code>npm i -g npm@7</code></p>
<h1>Usage</h1>
<ol>
<li>Create an instance of the MySqlConnection class (it is the default export)</li>
<li>Call execute() or transaction(). These accept a function that accepts a mysql2-promise connection object. The provided functions usually call query() on the connection object.</li>
<li>If you're using connection pooling, call stop() to close the connections in the pool. This is necessary if:</li>
</ol>
<ul>
<li>The app instantiates multiple instances to access the same database server. It is recommended to use a single global instance to avoid this issue.</li>
<li>The app hangs instead of terminating</li>
</ul>
<h1>Logger</h1>
<p>The options provided by the constructor and all other methods accept an optional 'logger' function or object. If an object is provided, it must have the method log().</p>
<pre class="prettyprint source lang-js"><code>interface Logger {
  /**
   * @param tags Typically includes a logging level name, like info or debug.
   * @param message An object with at least a message property
   */
  log(tags: string[] | string, message: Record&lt;string, unknown>): void;
}
</code></pre>
<h1>Example</h1>
<p>The following program outputs 'success' to the console.</p>
<pre class="prettyprint source lang-js"><code>const mysql = require('@goodware/mysql');

const config = {
  // host: '0.0.0.0', // This is the default
  // port: 3306, // This is the default
  // user: 'root', // This is the default
  // database: 'mysql', // This is the default
  password: 'password',
  usePool: true, // Defaults to 10 connections (see connectionLimit in constructor options)
};

async () => {
  const connector = new mysql(config, console.log); // The second parameter is a logger function
  // Acquire a database connection
  const result = await connector.execute( async (connection) => {
    // Perform database operations
    const [results] = await connection.query(`select 'success' AS status`);
    // The Promise resolves to 'success'
    return results[0].status;
  });
  // Close all database connections in the pool
  await connector.stop();
  // The Promise resolves to 'success'
  return result;
}().then(console.info, console.error);
</code></pre></article>
    </section>






</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on Sat Jan 02 2021 10:48:27 GMT-0800 (Pacific Standard Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>